{{- /* layouts/partials/head.html */ -}}
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">

<title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }}{{ with .Site.Params.titleDivider }}{{ printf " %s " . }}{{ end }}{{ .Site.Title }}{{ end }}</title>

{{- /* Description */ -}}
{{- $desc := .Description | default .Params.description | default .Site.Title -}}
{{- if $desc -}}<meta name="description" content="{{ $desc | plainify | html }}" />{{- end -}}

{{- /* Canonical */ -}}
<link rel="canonical" href="{{ .Permalink }}">

{{- /* Favicon - fallback to /favicon.ico if no param provided */ -}}
<link rel="icon" href="{{ with .Site.Params.favicon }}{{ . | relURL }}{{ else }}/favicon.ico{{ end }}" type="image/x-icon">

{{- /* RSS */ -}}
<link rel="alternate" type="application/rss+xml" title="{{ .Site.Title }}" href="{{ "index.xml" | relURL }}">

{{- /* Theme color - optional param */ -}}
{{- with .Site.Params.themeColor -}}<meta name="theme-color" content="{{ . }}">{{- end -}}

{{- /* Open Graph / Twitter */ -}}
<meta property="og:site_name" content="{{ .Site.Title }}">
{{- /* Titles for OG/Twitter (avoid "with ... else if" which is invalid) */ -}}
{{- $pageTitle := .Site.Title -}}
{{- if .Title -}}{{ $pageTitle = .Title }}{{- end -}}

{{- $ogTitle := $pageTitle -}}
{{- with .Params.ogTitle -}}{{ $ogTitle = . }}{{- end -}}

{{- $twTitle := $pageTitle -}}
{{- with .Params.twitterTitle -}}{{ $twTitle = . }}{{- end -}}

<meta property="og:title" content="{{ $ogTitle }}">
<meta name="twitter:title" content="{{ $twTitle }}">
<meta property="og:description" content="{{ $desc | default .Site.Params.description | plainify | html }}">
<meta property="og:url" content="{{ .Permalink }}">

{{- /* OG type: article for pages, otherwise website */ -}}
{{- $ogType := "website" -}}
{{- if .IsPage -}}{{ $ogType = "article" }}{{- end -}}
<meta property="og:type" content="{{ $ogType }}">

{{- /* choose image - page param, site param, or omit */ -}}
{{- $img := "" -}}
{{- with or .Params.images (slice .Params.image) (slice .Site.Params.social.image) -}}
  {{- $img = (index . 0) -}}
  <meta property="og:image" content="{{ $img | absURL }}">
  <meta name="twitter:image" content="{{ $img | absURL }}">
{{- end -}}

{{- /* twitter:card depends on whether we have an image */ -}}
{{- $twCard := "summary" -}}
{{- if $img -}}{{ $twCard = "summary_large_image" }}{{- end -}}
<meta name="twitter:card" content="{{ $twCard }}">
<meta name="twitter:title" content="{{ with .Params.twitterTitle }}{{ . }}{{ else }}{{ if .Title }}{{ .Title }}{{ else }}{{ .Site.Title }}{{ end }}{{ end }}">
<meta name="twitter:description" content="{{ $desc | plainify | html }}">

{{- /* CSS: prefer Hugo resources fingerprinting; fallback to static css */ -}}
{{- with resources.Get "css/styles.css" -}}
  {{- $styles := . | resources.Minify | resources.Fingerprint "sha384" -}}
  <link rel="stylesheet" href="{{ $styles.RelPermalink }}" integrity="{{ $styles.Data.Integrity }}">
{{- else -}}
  <link rel="stylesheet" href="{{ "css/styles.css" | relURL }}">
{{- end -}}

{{- /* Load any extra head HTML from site params (for analytics, verification tags, etc.) */ -}}
{{- with .Site.Params.extraHead -}}{{ . | safeHTML }}{{- end -}}

{{- /* Google Analytics (gtag) optional example - set Site.Params.gtag = 'G-XXXX' */ -}}
{{- with .Site.Params.gtag -}}
  <script async src="https://www.googletagmanager.com/gtag/js?id={{ . }}"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', '{{ . }}', { 'anonymize_ip': {{ default true .Site.Params.gaAnonymizeIP }} });
  </script>
{{- end -}}
